# interview
针对个人简历准备的面试题以及答案
# 1 Go：Goroutine、Channel、GMP 调度模型
中级题

# 2 Goroutine 为什么比线程轻量？实现原理是啥？

# 3 Channel 为什么是线程安全的？底层结构是什么？

# 4 无缓冲 Channel 和带缓冲 Channel 的调度区别？

# 5 defer 为什么会有性能开销？

# 6 Go 的 map 为什么并发不安全？

# 7 GC 三色标记算法怎么工作？为什么不会 STW？   
Go 的 GC 使用 三色标记法。
所有对象初始为 白色，从根对象开始标记为 灰色，处理灰色对象并将它引用的对象继续染灰，处理完变 黑色。
最后仍为白色的对象全部回收。
为了避免并发标记时对象引用变化导致漏标，Go 使用 写屏障，保证新增引用的对象立即标灰。
清理阶段是并发执行，STW 时间极短。   

为什么不会 STW？    
因为 Go 做了一个超级关键的优化：   

Go 有 “写屏障（write barrier）”，让你的程序在运行时主动告诉 GC：对象引用被我改掉啦！

写屏障就像 GC 的“监控器”。

只要你修改指针，GC 立刻知道，并采取动作保证不漏。

# 8 Goroutine 泄漏的场景有哪些？

高级题

GMP 模型中 M 和 P 的关系？为什么需要 work stealing？

Go 调度器如何避免全局锁？

阻塞系统调用对 GMP 的影响？如何优化？

Go Runtime 如何调度网络 IO？

Channel 底层锁竞争如何避免？为什么用了双锁 + ring buffer？

你如何在高并发场景下提高 Go 的吞吐？

sync.Pool 的重用原理是什么？什么时候不适合用？

Go 中的内存逃逸如何判断？怎么避免？

2️⃣ Gin / GoFrame 框架
核心中级题

Gin 是如何做到高性能路由匹配的？

中间件的执行顺序是怎么实现的？

GoFrame 的 IOC 容器是怎么做依赖注入的？

Gin 的 Context 是怎么做复用的？

为什么 Gin 不使用反射？带来了什么好处？

高级题

如何在 Gin / GoFrame 中实现一个可控制链路超时的 middleware？

高并发下如何减少 context.WithTimeout 的内存分配？

如何封装一个全局错误处理器（panic recover + 错误码 + trace）？

3️⃣ MySQL（索引、锁、分库分表、一致性）
中级题

聚簇索引和二级索引的区别是什么？为什么 MySQL 要用聚簇索引？

回表是什么？覆盖索引如何减少回表？

MySQL 的自增主键为什么会导致写热点？怎么优化？

MVCC 是如何实现快照读的？

MySQL 死锁常见场景有哪些？如何排查？

InnoDB 的行锁、间隙锁、临键锁分别是什么？

Count(*) 为什么会慢？

高级题

你怎么做分库分表？如何避免跨库查询？

分布式 ID 方案有哪些？雪花算法的缺点是什么？

# 3.10 如何实现 Redis + MySQL 数据的最终一致性？   
## 3.10.1 为什么会产生不一致？ 
因为 MySQL 是最终存盘，Redis 是缓存层，两者不是原子操作：   
写 MySQL 成了，但写 Redis 失败   
写 Redis 成了，但 MySQL 回滚了   
Redis 中的数据过期、被驱逐   
高并发下缓存与数据库并发修改   
多服务同时更新同一条记录   
## 3.10.2 解决方案 1：Cache Aside（旁路缓存，最推荐）
读：     
读 Redis     
没有 → 查 MySQL → 写回 Redis → 返回        
写：     
写 MySQL（主存）     
删除缓存（不是更新缓存！）     

为什么删除而不是更新？        
删除是幂等的，不会发生 “写旧值”     
高并发写时，更新缓存可能被覆盖     
📌 删除缓存是业界标准，尤其适用于用户资料、订单、配置等读多写少场景。     

优点     
逻辑简单，性能高     
Redis 挂掉仍能访问 MySQL     
高并发下较稳定     

缺点 ：       
写 → 删除缓存 没有事务，依旧会有极小的不一致窗口   
## 3.10.2 延时双删策略
写操作：   
删除缓存   
写 MySQL   
延迟 X ms 后再次删除缓存   
第二次删除避免并发请求在写入过程中把旧数据读入缓存。   
延时一般 100ms–500ms（根据 RT 决定）。   
缺点：不完全可靠，但能显著降低不一致概率   
## 3.10.3 异步消息队列保证最终一致性   
流程：
1 写 MySQL 成功     
2 发送 MQ 消息（保证至少一次投递）    
3 消费者收到消息 → 删除 Redis 缓存    
4 如果失败 → 重试 / 死信队列补偿    

适合：    
订单    
账号余额    
积分 ｜ 状态流转    
库存扣减    

优点：    
基本能做到最终一致    
可靠性高    

缺点：    
架构复杂    
需处理消息重复、延迟、幂等    
# 3.11 MySQL 主从延迟有哪些解决方案？

如何设计一个可扩展的索引策略？

大表字段变更如何做到不停机？

# 4️ Redis（缓存、锁、计数、存储）
中级题

Redis 为什么快？（单线程、IO 多路复用、数据结构）

Redis 的过期策略和逐出策略有哪些？

## 4.3 Redis 缓存问题
| 问题       | 触发原因                                | 核心解决方案（记这些就够了）                                                                                                 |
| -------- | ----------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| **缓存穿透** | 查一个根本不存在的 key，缓存没有、DB 也没有，每次都穿透 DB  | ✔ **布隆过滤器**（提前判断是否有可能存在）<br>✔ **缓存空值（null 缓存）**，给不存在的数据加一个短期空缓存<br>✔ 参数校验（非法 ID 不查 DB）                         |
| **缓存击穿** | 一个**热点 key** 在高并发时刻刚好过期，大量并发同时打到 DB | ✔ **互斥锁（Mutex）/ 单飞（SingleFlight）**：只有一个请求去 DB，其它等待<br>✔ **逻辑过期**（热点 key 永不过期，由后台异步刷新）<br>✔ **提前续期（过期时间+随机偏移）** |
| **缓存雪崩** | 大量 key 在同一时间过期，缓存整体失效（例如统一过期时间）     | ✔ **随机过期时间**（避免同一时刻失效）<br>✔ **多级缓存（本地 + Redis）**<br>✔ **限流 + 降级**<br>✔ Redis 高可用集群（避免整个 Redis 掉了）              |


Redis 集群 slot 分布是如何工作的？

Lua 脚本是怎么保证原子的？

高级题

分布式锁 RedLock 有哪些争议？生产环境怎么做更可靠？

如何实现一个 1 亿级访问量的分布式计数器？

大 key 问题如何排查？如何避免？

Redis 热 key 如何处理？

Redis 主从一致性如何保证？

5️ gRPC / Thrift / HTTP
中级题

gRPC 基于 HTTP/2 有哪些优势？

为什么 gRPC 的性能比 HTTP JSON 高？

Protobuf 的序列化结构？

gRPC 的连接池怎么管理？

gRPC 的 deadline / cancel 是怎么工作的？

高级题

如何在 gRPC 中实现灰度发布？

gRPC 长连接如何做负载均衡？

gRPC 调用链路如何做 tracing？

大型微服务的服务发现、熔断、限流怎么做？

你项目中的服务降级是怎么设计的？

6️⃣ Kafka / RocketMQ
中级题

Kafka 高吞吐的原因是什么？

ISR、HW、LEO 是什么？

为什么 Kafka 默认最多保证至少一次？

顺序消息如何实现？

消息堆积如何处理？

高级题

高并发下如何解决重复消费？

RocketMQ 的事务消息如何工作？

如何设计一个可回放的消息队列体系？

Kafka 分区过多会有什么问题？
# 7 Docker / K8s / CICD
中级题

Docker 镜像分层是怎么实现的？

为什么生产环境不建议 root 用户跑容器？

## 7.3 Kubernetes service 的流量转发机制？
ClusterIP（默认类型）,仅在集群内部可访问 ,转发机制是 通过 kube-proxy 维护 iptables/ipvs 规则，负载均衡到后端 Pod（默认轮询）   
NodePort ，外部访问：通过任意节点的 IP + 端口访问    
LoadBalancer，云平台集成：自动创建云负载均衡器    
实现机制：      
kube-proxy 的工作模式：    
1. iptables 模式   
2. ipvs（默认）    
   

Deployment 滚动更新流程？

K8s 如何处理 Pod crash？

高级题

你如何设计无损发布？

K8s 中如何实现自动扩容（HPA）？

Pod 网络模型（CNI）是如何通信的？

StatefulSet 为什么适合有状态服务？

如何排查集群中 CPU Throttle 问题？
8️⃣ Prometheus + Grafana
中级题

Prometheus 的 Pull 模型优势是什么？

Counter / Gauge / Histogram / Summary 区别？

什么是 P99？如何计算？

PromQL 如何写一个 QPS 查询？

如何监控 Goroutine、GC、Heap？

高级题

如何实现全链路 Trace？

如何构建一个 SLO + SLA 体系？

Grafana 如何与 Loki/Tempo 联合使用？

如何做报警的抖动防抖？
9️⃣ 网络：TCP、DNS、CDN
中级题

TCP 三次握手为什么不是两次？

TCP 粘包拆包怎么处理？

TIME_WAIT 多会导致什么？

DNS 缓存层级？

CDN 边缘节点的缓存策略？

高级题

如何排查线上丢包？（抓包 + 链路）

SYN Flood 防护方案？

CDN 回源慢如何诊断？

QUIC 相比 TCP 有哪些优势？
🔟 分布式理论与存储
中级题

CAP 理论是什么？

一致性协议：Paxos / Raft 有何不同？

分布式锁实现方式？

什么是雪崩、击穿、穿透？

高级题

如何设计一个分布式 KV？（如 Redis Lite）

如何实现分布式定时任务？

如何防止脑裂？

分布式事务 2PC / TCC 的优缺点？
